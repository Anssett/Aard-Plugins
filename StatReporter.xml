<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, March 04, 2024, 5:20 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "StatReporter" generated by Plugin Wizard -->

<muclient>
<plugin
   name="StatReporter"
   author="Anssett"
   id="6c556b5a5ad66909713bda73"
   language="Lua"
   purpose="report stats to provided channel"
   save_state="y"
   date_written="2024-03-04 17:18:08"
   requires="5.07"
   version="1.0"
   >
<description trim="y">
<![CDATA[
--------------------------
statrep <channel>
    - grabs some stats and reports to specified channel.
]]>
</description>

</plugin>


<!--  Triggers  -->

<triggers>
  <trigger
   expand_variables="y"
   group="statRepTrig"
   lines_to_match="14"
   keep_evaluating="y"
   match="^-{75}$\n^Your main attributes are:$\n\n^Str :\[\s*(?<totalStr>\d+)\/\s*(?<trainedStr>\d+)\]\s*Int :\[\s*(?<totalInt>\d+)\/\s*(?<trainedInt>\d+)\]\s*Wis :\[\s*(?<totalWis>\d+)\/\s*(?<trainedWis>\d+)\]\s*Hr :\[\s*(?<hr>\d+)\]$\n^Dex :\[\s*(?<totalDex>\d+)\/\s*(?<trainedDex>\d+)\]\s*Con :\[\s*(?<totalCon>\d+)\/\s*(?<trainedCon>\d+)\]\s*Luck:\[\s*(?<totalLuck>\d+)\/\s*(?<trainedLuck>\d+)\]\s*Dr :\[\s*(?<dr>\d+)\]$\n\n^Hp:\[\s*(?<currHp>\d+)\/\s*(?<maxHp>\d+)\]\s*Mn:\[\s*(?<currMn>\d+)\/\s*(?<maxMn>\d+)\]\s*Mv:\[\s*(?<currMv>\d+)\/\s*(?<maxMv>\d+)\]$\n\n^Trains: \[\s*(?<trains>\d+)\]\s*Pracs: \[\s*(?<pracs>\d+)\]\s*$\n\n^\(Use 'SCORE' and 'WHOIS' to see more details on your character\)$\n\n^\(Use 'RESISTS' to see your resistances\.\)$\n^-{75}$"
   multi_line="y"
   regexp="y"
   sequence="100"
   script="getStats"
  >
  </trigger>
  <trigger
   enabled="y"
   group="statRepTrig"
   match="^\{stopStats\}$"
   omit_from_output="y"
   regexp="y"
   script="stopStats"
   sequence="100"
  >
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   match="statRep *"
   enabled="y"
   expand_variables="y"
   ignore_case="y"
   script="startStats"
   sequence="100"
  >
  </alias>
    <alias
   script="OnHelp"
   match="StatReporter:help"
   enabled="y"
  >
  </alias>
</aliases>

<!--  Variables  -->

<!--  Script  -->


<script>
<![CDATA[

require "serialize"
local statString = ""
local statChannel = ""

function startStats(name, line, args)
    EnableTriggerGroup("statRepTrig",true)
    SendNoEcho("attrib")
    SendNoEcho("echo {stopStats}")
    statChannel = args[1]
end

function stopStats()
    EnableTriggerGroup("statRepTrig",false)
end

function getStats(name, line, args)
    statNameColor = "@C"
    statValColor = "@Y"
    stringEndColor = "@w"
    repPrefix = "@c<<@RSTATS@c>> "
    lb = "@c["
    rb = "@c]"
    sl = "@W/"

    DeleteLines(14)

    statTable = {
        total = {
            str=args.totalStr, int=args.totalInt, wis=args.totalWis, dex=args.totalDex, con=args.totalCon, luck=args.totalLuck
        },
        trained = {
            str=args.trainedStr, int=args.trainedInt, wis=args.trainedWis, dex=args.trainedDex, con=args.trainedCon, luck=args.trainedLuck, total=args.trainedTotal
        },
        misc = {
            hr=args.hr, dr=args.dr, currHp=args.currHp, maxHp=args.maxHp, currMn=args.currMn, maxMn=args.maxMn, currMv=args.currMv, maxMv=args.maxMv, trains=args.trains, pracs=args.pracs
        }
        }

    statTable.total.total = statTable.total.str + statTable.total.int + statTable.total.wis + statTable.total.dex + statTable.total.con + statTable.total.luck
    statTable.trained.total = statTable.trained.str + statTable.trained.int + statTable.trained.wis + statTable.trained.dex + statTable.trained.con + statTable.trained.luck

    --EnableTriggerGroup("statRepTrig",false)

    statString = repPrefix .. 
    		statNameColor .. "Str:"..lb..statValColor..statTable.trained.str..sl..statValColor..statTable.total.str..rb.." "..
    		statNameColor .. "Int:"..lb..statValColor..statTable.trained.int..sl..statValColor..statTable.total.int..rb.." "..
    		statNameColor .. "Wis:"..lb..statValColor..statTable.trained.wis..sl..statValColor..statTable.total.wis..rb.." "..
    		statNameColor .. "Dex:"..lb..statValColor..statTable.trained.dex..sl..statValColor..statTable.total.dex..rb.." "..
    		statNameColor .. "Con:"..lb..statValColor..statTable.trained.con..sl..statValColor..statTable.total.con..rb.." "..
    		statNameColor .. "Luck:"..lb..statValColor..statTable.trained.luck..sl..statValColor..statTable.total.luck..rb.." "..
    		statNameColor .. "Total:"..lb..statValColor..statTable.trained.total..sl..statValColor..statTable.total.total..rb.." "..
    		statNameColor .. "HR/DR:"..lb..statValColor..statTable.misc.hr..sl..statValColor..statTable.misc.dr..rb..stringEndColor

    SendNoEcho(statChannel.." " ..statString)
    end

function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end
]]>
</script>

</muclient>
